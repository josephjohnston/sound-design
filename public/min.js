window.onload=function(){dom=app.dom;colors=app.storage.colors;fonts=app.storage.fonts;sizes=app.storage.sizes;body=document.getElementsByTagName("body")[0];body.style.background=colors.gray8;var b=window.innerWidth;var a=window.innerHeight;app.init(b,a)};var dom;var body;var colors;var fonts;var sizes;var app={setVariables:function(b,a){var c=this;c.partsHeight=400;c.partTops=(a-c.partsHeight)/2+20;c.middleSpacing=20;c.planeWidth=800;c.sideBarWidth=340;c.sampleRate=44100;c.nyquist=c.sampleRate/2;c.numOctaves=Math.log(c.nyquist/10)/Math.LN2;c.initialTabName="wave"},filterValueToReal:function(c,b){var a=this,d;if(c==="frequency"){d=a.nyquist*Math.pow(2,a.numOctaves*(b-1))}else{if(c==="Q-factor"){d=1000*Math.pow(2,20*(b-1))}else{d=b}}return d},init:function(b,a){var c=this;c.storage.init();c.dom.init();c.setVariables(b,a);c.player.init();c.plane.init(b,a);c.sideBar.init(b,a);c.tabs.init(b,a);c.help.init(b,a)}};function preservePointer(){body.style.cursor="pointer"}function defaultCursor(){body.style.cursor="default"}function nsResizeCursor(){body.style.cursor="ns-resize"}function ewResizeCursor(){body.style.cursor="ew-resize"}window.oncontextmenu=function(a){a.preventDefault()};function preventDefaults(){window.addEventListener("mousedown",function(a){a.preventDefault()});window.addEventListener("mousemove",function(a){a.preventDefault()})}preventDefaults();exiting=undefined;window.addEventListener("mousedown",function(){if(exiting){exiting();exiting=undefined}});function randomColor(){var a=["blue","green","red","yellow","orange","purple"];return a[Math.floor(Math.random()*a.length)]}app.storage={setStyleAliasas:function(){var b=this.colors,a=fonts;b.divActive=b.gray2;b.textActive=b.gray4;b.divInactive=b.gray5;b.textInactive=b.gray5;b.railActive=b.gray3;b.blockActive=b.gray2;b.railInactive=b.gray5;b.blockInactive=b.gray5;b.buttonRegular=b.gray3point5;b.buttonHover=b.gray3;b.buttonActive=b.gray2;a.sideBar=a.text+"-UltraLight";a.button=a.text+"-UltraLight";b.itemRegular=b.gray3point5;b.itemHover=b.gray3;b.itemActive=b.gray2},colors:{black:"hsl(0,0%,0%)",gray0:"hsl(0,0%,12%)",gray1:"hsl(0,0%,18%)",gray2:"hsl(0,0%,24%)",gray3:"hsl(0,0%,36%)",gray3point5:"hsl(0,0%,42%)",gray4:"hsl(0,0%,48%)",gray5:"hsl(0,0%,60%)",gray6:"hsl(0,0%,72%)",gray7:"hsl(0,0%,84%)",gray8:"hsl(0,0%,96%)",white:"hsl(0,0%,100%)",wave:"hsl(123,50%,60%)",filters:"hsl(8,50%,60%)",envelope:"hsl(282,50%,60%)"},fonts:{text:"HelveticaNeue"},sizes:{sliderHeight:10,sliderIconWidth:3},instrumentTabs:{wave:function(h,j,k){h.clearRect(0,0,j,j);h.beginPath();var g=j*1/4,e=j*3/4,m=(g+e)/2,l=(e-g)/2;h.moveTo(g,e+l/8);h.quadraticCurveTo(m,0-l/4,e,m);h.arc(e-l/8,m+l/2,l/2,3/2*Math.PI,1/2*Math.PI,true);h.closePath();var f=app.storage.colors;h.fillStyle=f.gray2;h.fill()},filters:function(h,j,k){h.clearRect(0,0,j,j);h.beginPath();var g=j*1/4,e=j*3/4,m=(g+e)/2,l=(e-g)/2;h.moveTo(g,g);h.lineTo(m-l/4,m);h.lineTo(m-l/4,m+l/1.5);h.lineTo(m+l/4,e+l/4);h.lineTo(m+l/4,m);h.lineTo(e,g);h.closePath();var f=app.storage.colors;h.fillStyle=f.gray2;h.fill()},envelope:function(n,j,f){n.clearRect(0,0,j,j);n.beginPath();var m=j*1/4,l=j*3/4,k=(m+l)/2,h=(l-m)/2,g=h/4,e=app.storage.colors;n.strokeStyle=e.black;n.fillStyle=e.gray3;n.lineCap="round";n.lineWidth=h/8;n.moveTo(m-g,m+g);n.lineTo(l+g,m+g);n.lineTo(l+g,l-g);n.lineTo(m-g,l-g);n.closePath();n.fill();n.stroke();n.beginPath();n.moveTo(m-g,l-g);n.lineTo(k,m+g);n.lineTo(l+g,l-g);n.fill();n.stroke();n.beginPath();n.moveTo(m-g,m+g);n.lineTo(k,k+h/4);n.lineTo(l+g,m+g);n.closePath();n.fill();n.stroke()}},waveIcons:[{name:"sine",icon:{draw:function(e,f){var d=f/4,c=f-d;e.lineWidth=sizes.sliderIconWidth;e.strokeStyle=colors.wave;e.clearRect(0,0,f,f);e.beginPath();e.moveTo(d,c);e.quadraticCurveTo((d+c)/2,-d,c,c);e.stroke()}}},{name:"square",icon:{draw:function(e,f){var d=f/4,c=f-d;e.lineWidth=sizes.sliderIconWidth;e.strokeStyle=colors.wave;e.clearRect(0,0,f,f);e.beginPath();e.moveTo(d,c);e.lineTo(d,d);e.lineTo(c,d);e.lineTo(c,c);e.stroke()}}},{name:"sawtooth",icon:{draw:function(e,f){var d=f/4,c=f-d;e.lineWidth=sizes.sliderIconWidth;e.strokeStyle=colors.wave;e.clearRect(0,0,f,f);e.beginPath();e.moveTo(d,c);e.lineTo(c,d);e.lineTo(c,c);e.stroke()}}},{name:"triangle",icon:{draw:function(e,f){var d=f/4,c=f-d;e.lineWidth=sizes.sliderIconWidth;e.strokeStyle=colors.wave;e.clearRect(0,0,f,f);e.beginPath();e.moveTo(d,c);e.lineTo((d+c)/2,d);e.lineTo(c,c);e.stroke()}}},{name:"custom",icon:{draw:function(g,h){var f=h*1/4,e=h*3/4,k=(f+e)/2,j=(e-f)/2;g.lineWidth=sizes.sliderIconWidth;g.strokeStyle=colors.wave;g.clearRect(0,0,h,h);g.beginPath();g.moveTo(f,k+j/8);g.quadraticCurveTo(f+j/4,f,f+j/2,k);g.quadraticCurveTo(k-j/4,e+j,k,k);g.quadraticCurveTo(k+j/4,f-j,k+j/2,k);g.quadraticCurveTo(e-j/3,e-j/8,e-j/6,k);g.quadraticCurveTo(e-j/8,k-j/2,e,k+j/4);g.stroke()}}}],envelopeTypes:[{name:"linear",icon:{draw:function(e,f){var d=f/4,c=f-d;e.lineWidth=sizes.sliderIconWidth;e.strokeStyle=colors.envelope;e.clearRect(0,0,f,f);e.beginPath();e.moveTo(d,c);e.lineTo(c,d);e.stroke()}}},{name:"exponential",icon:{draw:function(e,f){var d=f/4,c=f-d;e.lineWidth=sizes.sliderIconWidth;e.strokeStyle=colors.envelope;e.clearRect(0,0,f,f);e.beginPath();e.moveTo(d,c);e.quadraticCurveTo(c,c,c,d);e.stroke()}}}],filterIcons:{highpass:function(e,f){var d=f/4,c=f-d;e.clearRect(0,0,f,f);e.beginPath();e.moveTo(d,c);e.quadraticCurveTo(d,d,c,d);e.stroke()},lowshelf:function(f,g){var e=g/4,d=g-e,h=e+(d-e)/2;f.clearRect(0,0,g,g);f.beginPath();f.moveTo(d,d);f.quadraticCurveTo(h,d,h,h);f.quadraticCurveTo(h,e,e,e);f.stroke()},bandpass:function(f,g){var e=g/4,d=g-e,h=e+(d-e)/2;f.clearRect(0,0,g,g);f.beginPath();f.moveTo(e,d);f.quadraticCurveTo(h,d,h,e);f.quadraticCurveTo(h,d,d,d);f.stroke()},peaking:function(f,g){var e=g/4,d=g-e,h=e+(d-e)/2;f.clearRect(0,0,g,g);f.beginPath();f.moveTo(e,d);f.quadraticCurveTo(h,-e,d,d);f.stroke()},notch:function(f,g){var e=g/4,d=g-e,h=e+(d-e)/2;f.clearRect(0,0,g,g);f.beginPath();f.moveTo(e,e);f.quadraticCurveTo(h,e,h,d);f.quadraticCurveTo(h,e,d,e);f.stroke()},highshelf:function(f,g){var e=g/4,d=g-e,h=e+(d-e)/2;f.clearRect(0,0,g,g);f.beginPath();f.moveTo(e,d);f.quadraticCurveTo(h,d,h,h);f.quadraticCurveTo(h,e,d,e);f.stroke()},lowpass:function(e,f){var d=f/4,c=f-d;e.clearRect(0,0,f,f);e.beginPath();e.moveTo(c,c);e.quadraticCurveTo(c,d,d,d);e.stroke()}},init:function(){this.setStyleAliasas()}};app.dom={HtmlObject:function(a){this.element=document.createElement(a)},create:function(b,a){var c=new this.HtmlObject(b);if(a){a.appendChild(c.element)}if(b==="canvas"){c.element.context=c.element.getContext("2d")}c.element.set=function(){return c};return c.element},destroy:function(a){var b=a.parentNode;b.removeChild(a)},makeCanvasButton:function(f,b,h,d){var g=this,c=g.create("canvas",f),a=c.getContext("2d");c.set().canWidth(b.width).canHeight(b.height).background(b.background).borderRadius(b.borderRadius);h.regular(a,b.width,b.height);function e(){a.clearRect(0,0,b.width,b.height)}c.onmouseenter=function(){e();preservePointer();h.hover(a,b.width,b.height)};c.onmouseleave=function(){e();defaultCursor();h.regular(a,b.width,b.height)};c.onmousedown=function(){e();h.active(a,b.width,b.height)};c.onmouseup=function(){e();h.hover(a,b.width,b.height)};c.onclick=function(){preservePointer();d()};return c},makeButton:function(g,k,h,j,d){var e=this,a=e.create("div",g),b=h.background,f=h.hover,c=h.active;a.set().width(h.width).height(h.height).background(b).borderRadius(h.borderRadius).display("table");a.p=e.create("p",a);a.p.set().innerHTML(k).color(h.color||"white").textAlign("center").display("table-cell").verticalAlign("middle").font(h.font).size(h.size).paddingBottom(1);a.resetBackground=function(l){b=l;this.style.background=b};a.text=function(){return a.p.set()};a.onmouseenter=function(){if(d&&d.mouseenter){d.mouseenter()}preservePointer();a.style.background=f};a.onmouseleave=function(){if(d&&d.mouseleave){d.mouseleave()}defaultCursor();a.style.background=b};a.onmousedown=function(){if(d&&d.mousedown){d.mousedown()}a.style.background=c};a.onmouseup=function(){if(d&&d.mouseup){d.mouseup()}a.style.background=f};a.onclick=function(){preservePointer();j()};return a},makeButtonLink:function(c,f,a,b,h){var e=this,g=e.create("div",c);g.set().width(a.width).height(a.height).background(a.background).borderRadius(a.borderRadius);var d=e.create("a",g);d.set().paragraph(f,a).display("block").width(a.width).height(a.height);d.href=b;d.style.textDecoration="none";g.onmouseenter=function(){this.style.background=a.hover};g.onmouseleave=function(){this.style.background=a.background};if(h){g.onclick=function(j){j.preventDefault();preservePointer();h()}}return g},makeTextLink:function(h,d,c,a,b){var f=this,e=f.create("a",d),g=document.createTextNode(h);e.appendChild(g);e.style.color=a.color;e.href=b;e.style.textDecoration="none";e.onmouseenter=function(){e.style.textDecoration="underline"};e.onmouseleave=function(){e.style.textDecoration="none"};return e},makeSlider:function(o,r,j,f){var g=this,c=g.create("div",o),e=g.create("div",c),h=10,b=j[0],l=j[1],m=j[2],n=r.width/Math.abs(l-b),k=(n*(m-j[0])-h/2),q=false,d=false;c.set().width(r.width).height(r.height).background(colors.railActive).borderRadius(r.height/2);e.set().position("absolute").width(h).height(r.height*2).top(-r.height/2).left(k).background(colors.blockActive);c.makeInactive=function(){d=true;e.set().left(k);c.set().background(colors.railInactive);e.set().background(colors.blockInactive)};c.makeActive=function(){d=false;c.set().background(colors.railActive);e.set().background(colors.blockActive)};c.hide=function(){c.set().display("none");e.set().display("none")};c.show=function(){c.set().display("block");e.set().display("block")};c.setValue=function(t){var u=Math.abs(t-b),s=u*n;e.set().left(s-h/2);f(t)};function p(t){var s=c.getBoundingClientRect();return t.clientX-s.left}c.onmouseenter=function(){if(!d){preservePointer()}};c.onmouseleave=function(){if(!d){defaultCursor()}};c.onmousedown=function(u){if(d){return}var t=p(u),s=t;if(t<=0||r.width<=t){return}e.set().left(s-h/2);a(s);q=true};e.onmousedown=function(t){if(d){return}var s=p(t);q=true};window.addEventListener("mouseup",function(){q=false;defaultCursor()});window.addEventListener("mousemove",function(v){if(!q){return}v.preventDefault();var t=p(v),s=t,u;preservePointer();if(!(0<=s)){u=-h/2}else{if(!(s<=r.width)){u=r.width-h/2}else{u=s-h/2}}e.set().left(u);if(0<=s&&s<=r.width){a(s)}});function a(s){var t=b+s/n;if(m===t){return}m=t;f(m)}c.getValue=function(){return m};return c},setPrototype:function(a){var b=this;this.HtmlObject.prototype={width:function(c){this.element.style.width=c+"px";return this},height:function(c){this.element.style.height=c+"px";return this},background:function(c){this.element.style.background=c;return this},position:function(c){this.element.style.position=c;return this},left:function(c){this.element.style.left=c+"px";return this},top:function(c){this.element.style.top=c+"px";return this},borderRadius:function(d,c){var e=this;if(c){c.forEach(function(f){e.element.style["border"+f+"Radius"]=d+"px"})}else{this.element.style.borderRadius=d+"px"}return this},backgroundImage:function(c){this.element.style.backgroundImage=c;return this},overflow:function(c){this.element.style.overflow=c;return this},border:function(d,c,e){var f=this;if(e){e.forEach(function(g){f.element.style["border"+g]=d+"px solid "+c})}else{this.element.style.border=d+"px solid "+c}return this},borderTop:function(d,c){var e=this;this.element.style.borderTop=d+"px solid "+c;return this},borderBottom:function(d,c){var e=this;this.element.style.borderBottom=d+"px solid "+c;return this},borderLeft:function(d,c){var e=this;this.element.style.borderLeft=d+"px solid "+c;return this},borderRight:function(d,c){var e=this;this.element.style.borderRight=d+"px solid "+c;return this},margin:function(d,c){var e=this;if(c){c.forEach(function(f){e.element.style["margin"+f]=d+"px"})}else{this.element.style.margin=d+"px"}return this},zIndex:function(c){this.element.style.zIndex=c;return this},display:function(c){this.element.style.display=c;return this},transition:function(c){this.element.style.WebkitTransition=c;return this},transform:function(c){this.element.style.WebkitTransform=c;return this},font:function(c){this.element.style.fontFamily=c;return this},size:function(c){this.element.style.fontSize=c+"px";return this},color:function(c){this.element.style.color=c;return this},text:function(d){var c=this.element;c.appendChild(document.createTextNode(d));return this},textAlign:function(c){this.element.style.textAlign=c;return this},verticalAlign:function(c){this.element.style.verticalAlign=c;return this},innerHTML:function(c){this.element.innerHTML=c;return this},paddingBottom:function(c){this.element.style.paddingBottom=c+"px";return this},boxShadow:function(d,f,g,e,c){this.element.style.boxShadow=d+"px "+f+"px "+g+"px "+e+"px "+c;return this},padding:function(e,c){var d=this;if(c){c.forEach(function(f){d.element.style["padding"+f]=e+"px"})}else{this.element.style.padding=e+"px"}return this},paragraph:function(f,c){var d=b.create("p",this.element),e=document.createTextNode(f);d.appendChild(e);if(c){d.style.display="table-cell";d.style.verticalAlign="middle";d.style.textAlign="center";d.style.color=c.color;d.style.fontFamily=c.font;d.style.fontSize=c.size+"px";d.style.paddingBottom="1px"}return this},mousePointer:function(c){var d=this;this.element.onmouseenter=function(){if(c){c.forEach(function(e){console.log();d.element.set()[e[0]](e[1])})}preservePointer()};this.element.onmouseleave=function(){if(c){c.forEach(function(e){d.element.set()[e[0]](e[2])})}defaultCursor()};return this},canWidth:function(c){this.element.width=c;return this},canHeight:function(c){this.element.height=c;return this},att:function(c,d){this.element.setAttribute(c,d);return this},outline:function(c){this.element.style.outline=c;return this}}},makeSelector:function(l,c,h,d,k,o,j,m,b){var f={};f.onItem=false;f.button={items:d,points:{}};f.button.changeItem=function(r){var s=this.items[r];if(b){this.currentItem=s;var p=f.button.canvas.context,q=f.button.points.side;this.currentItem.icon.draw(p,q)}else{f.button.div.text().innerHTML(s.name)}};f.button.points.side=k.width;f.button.points.top=h;f.button.points.left=c;if(b){f.button.currentItem=undefined;f.button.canvas=dom.create("canvas",l);f.button.canvas.set().canWidth(f.button.points.side).canHeight(f.button.points.side).background(k.background).borderRadius(k.borderRadius).position("absolute").left(f.button.points.left).top(f.button.points.top);var n=f.button.canvas.context,g=f.button.points.side;f.button.canvas.onmouseenter=function(){preservePointer()};f.button.canvas.onmouseleave=function(){defaultCursor()};f.button.canvas.onmousedown=function(){};f.button.canvas.onmouseup=function(){};f.button.canvas.onclick=function(){preservePointer();f.pop.div.show();exiting=function(){if(!f.onItem){f.pop.div.hide()}}}}else{f.button.div=dom.makeButton(l,"",k,function(){f.pop.div.show();exiting=function(){if(!f.onItem){f.pop.div.hide()}}});f.button.div.set().position("absolute").left(f.button.points.left).top(f.button.points.top)}f.pop={items:[],points:{}};for(var e=0;e<o.length;e++){f.pop.items.push({data:o[e]})}f.pop.points.side=j.width;f.pop.points.padding=8;f.pop.points.top=f.button.points.top-f.pop.points.padding;f.pop.points.left=c;f.pop.points.height=f.pop.items.length*f.pop.points.side+f.pop.points.padding*2;f.pop.div=dom.create("div",l);f.pop.div.set().width(f.pop.points.side).height(f.pop.points.height).background(colors.gray3).position("absolute").left(f.pop.points.left).top(f.pop.points.top).borderRadius(f.pop.points.padding).display("none");f.pop.div.hide=function(){f.pop.div.style.display="none";f.pop.div.style.zIndex="0"};f.pop.div.show=function(){f.pop.div.style.zIndex="1";f.pop.div.style.display="block"};f.pop.points.pos=f.pop.points.top;f.pop.div.onmousewheel=function(r){r.preventDefault();var p=r.clientY-l.getBoundingClientRect().top,q=f.pop.points.pos+r.wheelDelta/3;if(p<=q+f.pop.points.padding){q=p-f.pop.points.padding}else{if(q+f.pop.points.height-f.pop.points.padding<=p){q=p-f.pop.points.height+f.pop.points.padding}}if(f.button.points.top<q+f.pop.points.padding){q=f.button.points.top-f.pop.points.padding}else{if(q+f.pop.points.height-f.pop.points.padding<=f.button.points.top+f.button.points.side){q=f.button.points.top+f.button.points.side-f.pop.points.height+f.pop.points.padding}}f.pop.points.pos=q;f.pop.div.style.top=f.pop.points.pos+"px"};function a(){for(var p=0;p<f.pop.items.length;p++){(function(u){var r=f.pop.points.side;if(b){u.canvas=dom.create("canvas",f.pop.div);u.canvas.set().position("absolute").canWidth(r).canHeight(r).background(colors.itemRegular).top(r*p+f.pop.points.padding);var q=u.canvas.context,t=u.data.icon;t.draw(q,r);u.canvas.onmousedown=function(){u.canvas.set().background(colors.itemActive);f.onItem=true};u.canvas.onmouseup=function(){f.onItem=false};u.canvas.onmouseenter=function(){u.canvas.set().background(colors.itemHover);preservePointer()};u.canvas.onmouseleave=function(){u.canvas.set().background(colors.itemRegular);defaultCursor()};u.canvas.onclick=function(){m(u.data);f.pop.div.hide();f.button.changeItem(f.pop.items.indexOf(u))}}else{var s={mousedown:function(){f.onItem=true},mouseup:function(){f.onItem=false}};u.div=dom.makeButton(f.pop.div,u.data.name,j,function(){m(u.data);f.pop.div.hide();f.button.changeItem(f.pop.items.indexOf(u))},s);u.div.set().position("absolute").top(f.pop.points.side*p+f.pop.points.padding)}})(f.pop.items[p])}}a();f.changeItems=function(q,r){f.button.items=q;f.pop.items=[];for(var p=0;p<r.length;p++){f.pop.items.push({data:r[p]})}f.pop.div.innerHTML="";f.pop.points.height=f.pop.items.length*f.pop.points.side+f.pop.points.padding*2;f.pop.div.set().height(f.pop.points.height).top(f.pop.points.top);f.pop.points.pos=f.pop.points.top;a()};return f},Selector:function(j,c,h,g,d,b,a,k,e){var f=this;f.showingPopup=false;f.popupPadding=a;f.popupTop=-f.popupPadding;f.itemHeight=e;f.popupHeight=undefined;f.top=h;f.left=c;f.display=g;f.displayHeight=d;f.popup=dom.create("div",j);f.popup.set().width(b).borderRadius(k).background("blue").display("none").position("absolute").top(f.top+f.popupTop).left(f.left);f.display.onclick=function(){preservePointer();f.showingPopup=true;f.showPopup()};f.popup.onmousedown=function(l){l.cancelBubble=true};f.popup.onclick=function(l){l.cancelBubble=true;f.showingPopup=false;f.hidePopup()};f.popup.onmousewheel=function(m){m.preventDefault();var l=m.clientY-g.getBoundingClientRect().top;f.scroll(f.popupTop-m.deltaY,l)};window.addEventListener("mousedown",function(l){if(f.showingPopup){f.showingPopup=false;f.hidePopup()}});f.popup.onmouseenter=function(){preservePointer()};f.popup.onmouseleave=function(){defaultCursor()}},setSelectorPrototype:function(){this.Selector.prototype={scroll:function(c,b){var a=this;if(0-a.popupPadding<c){c=-a.popupPadding}if(b-a.popupPadding<c){c=b-a.popupPadding}if(c+(a.popupHeight-a.popupPadding)<a.displayHeight-1){c=a.displayHeight-(a.popupHeight-a.popupPadding)+1}if(c+(a.popupHeight-a.popupPadding)<b-1){c=b-(a.popupHeight-a.popupPadding)+1}a.popup.set().top(a.top+c);a.popupTop=c},showPopup:function(){this.popup.set().zIndex(1).display("block")},hidePopup:function(){this.popup.set().zIndex("auto").display("none")},loadItems:function(a){var c=this;c.popupHeight=c.popupPadding*2+c.itemHeight*a.length;c.popup.set().height(c.popupHeight);for(i=0;i<a.length;i++){var b=a[i];c.popup.appendChild(b);b.set().position("absolute").left(0).top(c.popupPadding+i*c.itemHeight)}}}},Scroller:function(j,c,k,h,b,g,d,a){var f=this;f.width=c;f.height=k;f.tileConstructor=a;f.rowNum=h;f.totalRowNum=f.rowNum+1;f.colNum=b;f.sidebarWidth=d;f.tilePadding=g;f.halfPadding=f.tilePadding/2;f.colWidth=f.width/f.colNum;f.rowHeight=f.height/f.rowNum;f.tileWidth=f.colWidth-f.tilePadding;f.tileHeight=f.rowHeight-f.tilePadding;f.containerHeight=undefined;f.rows=[];for(var e=0;e<f.totalRowNum;e++){f.rows.push([])}f.stream=[];f.topRows=0;f.top=0;f.clickedY=undefined;f.holder=dom.create("div",j);f.holder.set().width(f.width+f.sidebarWidth+f.halfPadding).height(f.height).overflow("hidden");f.container=dom.create("div",f.holder);f.container.set().left(f.halfPadding+f.sidebarWidth).width(f.width).position("absolute");f.sidebar=dom.create("div",f.holder);f.sidebar.set().width(f.sidebarWidth).background("black").borderRadius(f.sidebarWidth).position("absolute").left(f.halfPadding);f.container.onmousewheel=function(l){l.preventDefault();f.moveContainer(f.top-l.deltaY);f.moveSidebar();f.moveRows()},f.holder.onmousedown=function(p){p.preventDefault();var n=this.getBoundingClientRect(),o=p.clientX-n.left;mY=p.clientY-n.top;if(f.tilePadding+f.sidebarWidth<o){return}if(f.insideSidebar(mY)){var m=Math.abs(f.top)/f.containerHeight*f.height;f.clickedY=mY-m}else{var l=mY/f.height*f.containerHeight-f.height/2;f.jumpToPoint(-l);f.clickedY=f.height/f.containerHeight*f.height/2}};window.addEventListener("mousemove",function(n){if(f.clickedY!==undefined){var m=n.clientY-f.holder.getBoundingClientRect().top,l=(m-f.clickedY)/f.height*f.containerHeight;f.jumpToPoint(-l)}});window.addEventListener("mouseup",function(l){if(f.clickedY!==undefined){f.clickedY=undefined}});f.makeTiles()},setScrollerPrototype:function(){this.Scroller.prototype={moveContainer:function(b){var a=this;if(0<b){b=0}else{if(b+a.containerHeight<a.height){b=a.height-a.containerHeight}}a.top=b;a.container.set().top(a.top)},moveRows:function(){var d=this,c=Math.floor(Math.abs(d.top+1)/d.rowHeight);if(d.topRows===c){return}var b=d.topRows-c;if(b<0){for(var a=0;a<Math.abs(b);a++){var g=d.rows.splice(0,1)[0];d.rows.push(g);d.topRows++;var e=d.halfPadding+d.topRows*d.rowHeight+d.rowNum*d.rowHeight,f=d.topRows*d.colNum+d.rowNum*d.colNum;d.moveRow(d.rows.length-1,e);d.loadRow(d.rows.length-1,f)}}else{for(var a=0;a<b;a++){var g=d.rows.splice(d.rows.length-1,1)[0];d.rows.unshift(g);d.topRows--;var e=d.halfPadding+d.topRows*d.rowHeight,f=d.topRows*d.colNum;d.moveRow(0,e);d.loadRow(0,f)}}},jumpToPoint:function(b){var a=this;a.moveContainer(b);a.moveSidebar();a.moveRows()},insideSidebar:function(c){var b=this,d=Math.abs(b.top)/b.containerHeight*b.height,a=d+b.height/b.containerHeight*b.height;if(d<c&&c<=a){return true}else{return false}},moveSidebar:function(){var a=this;a.sidebar.set().top(Math.abs(a.top)/a.containerHeight*a.height)},changeHeight:function(){var a=this;a.containerHeight=Math.ceil(a.stream.length/a.colNum)*a.rowHeight;a.container.set().height(a.containerHeight);a.sidebar.set().height(a.height/a.containerHeight*a.height)},moveRow:function(c,b){for(var a=0;a<this.rows[c].length;a++){this.rows[c][a].container.set().top(b)}},loadRow:function(c,b){for(var a=0;a<this.rows[c].length;a++){this.rows[c][a].load(this.stream[b+a])}},partialLoad:function(e,a,b){var d=this;d.changeHeight();d.drawSidebar();for(var c=0;c<d.totalRowNum;c++){if(e<=d.topRows+c){d.loadRow(c,d.topRows*d.colNum+c*d.colNum)}}},loadStream:function(c){var b=this;if(c){b.stream=c}b.changeHeight();b.moveSidebar();for(var a=0;a<b.totalRowNum;a++){b.loadRow(a,b.topRows*b.colNum+a*b.colNum)}},makeTiles:function(){var d=this;for(var b=0;b<d.totalRowNum;b++){for(var e=0;e<d.colNum;e++){var a=new d.tileConstructor(d,d.tileWidth,d.tileHeight);d.moveToColumn(a,e);d.moveToRow(a,b);d.rows[b].push(a)}}},removeTile:function(d,c,g,b){var e=this,a=new e.tileConstructor(e,e.tileWidth,e.tileHeight),f;if((g&&b)===undefined){g=Math.floor(c/e.colNum);b=c%e.colNum}else{if(c===undefined){c=e.topRows*e.colNum+g*e.colNum+b}}f=e.rows[g];e.moveToColumn(a,b);e.moveToRow(a,g);f.splice(b,1,a);e.stream.splice(c,1);e.partialLoad(g,b,c)},insertTile:function(b){var c=this,a=c.topRows*c.colNum;c.stream.splice(a,0,b.content);c.partialLoad(Math.floor(a/c.colNum),a%c.colNum,a)},moveToColumn:function(b,a){b.container.set().left(Math.round(this.halfPadding+a*this.colWidth))},moveToRow:function(a,b){a.container.set().top(this.halfPadding+this.topRows*this.rowHeight+b*this.rowHeight)}}},init:function(){var a=this;a.setPrototype();a.setSelectorPrototype();a.setScrollerPrototype()}};app.player={setVariables:function(){var c=this;c.initialFilterValues={_1:[0.4,0,26],_3:[0.6,0.5,20],_6:[0.8,0,0],_default:[0.5,0.5,20]};c.context=new webkitAudioContext();var j=c.context;c.assetType="osc";c.coefs=undefined;c.buffer=undefined;c.nyquist=app.nyquist;c.filterNames=["highpass","lowshelf","bandpass","peaking","notch","highshelf","lowpass"];c.filterProperties={highpass:["frequency","Q-factor"],lowshelf:["frequency","gain"],bandpass:["frequency","Q-factor"],peaking:["frequency","Q-factor","gain"],notch:["frequency","Q-factor"],highshelf:["frequency","gain"],lowpass:["frequency","Q-factor"]};c.filterRanges=[{property:"frequency",range:[0,1]},{property:"Q-factor",range:[0,1]},{property:"gain",range:[-40,40]}];c.filterModes=[false,false,false,false,false,false,false];c.filters={};for(var d=0;d<c.filterNames.length;d++){var a=c.filterNames[d],f=j.createBiquadFilter();f.type=a;f.frequency.value=g("frequency");var e=c.filterProperties[a];for(var b=0;b<e.length;b++){var h=e[b];if(h==="Q-factor"){f.Q.value=g(h)}else{if(h==="gain"){f.gain.value=g(h)}}}c.filters[d+""]={engine:f,mode:c.filterModes[d]}}function g(n){for(var k=0;k<c.filterRanges.length;k++){var l=c.filterRanges[k];if(l.property===n){var m=l.range[2],o=app.filterValueToReal(n,m);return o}}}c.periodicWave=undefined;c.analyser=j.createAnalyser();c.fftSize=2048;c.binCount=c.fftSize/2;c.sampleRate=app.sampleRate;c.binResolution=c.sampleRate/c.fftSize;c.totalFrequencies=c.binCount*c.binResolution;c.envelopeDuration=4;c.envelopeProperties=["attack","decay","sustain","release"];c.envelopeValues={attack:c.envelopeDuration/8,decay:c.envelopeDuration/4,sustain:1/2,release:c.envelopeDuration/2,};c.envelopeTypes={attack:"linear",decay:"exponential",release:"exponential",};c.input=j.createGain();c.compressor=j.createDynamicsCompressor();c.waveShaper=j.createWaveShaper();c.waveShaper.curve=new Float32Array(0.9,0.1,0.1);c.compressor.connect(c.waveShaper);c.waveShaper.connect(c.analyser);c.analyser.connect(j.destination);c.keyMap={"65":0,"87":1,"83":2,"69":3,"68":4,"70":5,"84":6,"71":7,"89":8,"72":9,"85":10,"74":11,"75":12,"79":13,"76":14,"80":15,"186":16,"222":17,"221":18,"13":19}},sendFilterResponses:function(){var h=this,a=[],l=app.plane.filters,v=app.sideBar.filters.blocks,d=app.sideBar.filters.currentBlock,s=h.context,o=h.filterNames,g=l.width,w=l.numOctaves;for(var t=0;t<o.length;t++){var x=o[t],n=h.filters[t+""];if(!n.mode){continue}var b=new Float32Array(g),e=new Float32Array(g),c=new Float32Array(g),j=[];for(var u=0;u<g;u++){var q=u/g;b[u]=h.nyquist*Math.pow(2,w*(q-1))}n.engine.getFrequencyResponse(b,e,c);for(var r=0;r<g;r++){var p=20*Math.log(e[r])/Math.LN10;p*=2;j.push(p)}var k=v[t+""];a.push({hue:k.hue,active:(k===d),data:j})}return a},sendFrequencies:function(){var b=this,a=new Uint8Array(b.binCount);b.analyser.getByteFrequencyData(a);return a},handleKeys:function(){var f=this,c=Math.pow(2,1/12),e=440/Math.pow(c,9),d={},g=[];function b(k){if(!(f.waveType||f.coefs||f.buffer)){return}var j=e*Math.pow(c,k),h=new f.Note(j);h.on();d[k+""]=h}function a(j){if(!(f.waveType||f.coefs||f.buffer)){return}var h=d[j+""];h.off();h=undefined}document.onkeydown=function(j){var h=j.keyCode,k=f.keyMap[j.keyCode];if(k===undefined||g.indexOf(h)>-1){return}g.push(h);b(k)};document.onkeyup=function(j){var h=j.keyCode,k=f.keyMap[h];if(k===undefined||g.indexOf(h)===-1){return}g.splice(g.indexOf(h),1);a(k)}},translateProperty:function(a){switch(a){case"frequency":case"gain":return a;break;case"Q-factor":return"Q";break}},changeEnvelope:function(e,b,d){var c=this,a=c.context;c.envelopeValues[e]=d;if(e!=="sustain"){c.envelopeTypes[e]=b}},changeWave:function(b,d){var c=this;if(b==="curved"){c.assetType="osc";c.waveType="custom";var a=d;c.periodicWave=c.context.createPeriodicWave(a.real,a.imag)}else{if(b==="static"){c.assetType="buffer";c.buffer=d}else{c.assetType="osc";c.waveType=d}}},toggleFilterMode:function(a){var c=this,b=c.filters[a];if(!b.mode){b.mode=true}else{b.mode=false}c.assembleFilters()},assembleFilters:function(){var d=this;d.input.disconnect(0);for(var a=0,e=[];a<d.filterNames.length;a++){var b=d.filters[a+""];b.engine.disconnect(0);if(b.mode!==false){e.push(b)}}for(var a=0,c;a<e.length;a++){var b=e[a];if(a===0){d.input.connect(b.engine)}else{c.engine.connect(b.engine)}if(a===e.length-1){b.engine.connect(d.compressor)}c=b}if(e.length===0){d.input.connect(d.compressor)}},changeFilterValue:function(a,e,d){var c=this,b=c.filters[a+""],f=c.translateProperty(e);b.engine[f].value=d},Note:function(b){var a=this;a.assignAsset(b);a.startTime=undefined},setNotePrototype:function(){var b=this,a=b.context;b.Note.prototype={assignAsset:function(h){var g=this;g.asset=undefined;if(b.assetType==="osc"){g.asset=a.createOscillator();g.asset.frequency.value=h;if(b.waveType==="custom"){g.asset.setPeriodicWave(b.periodicWave)}else{g.asset.type=b.waveType}}else{var c=a.createBuffer(1,b.buffer.length,a.sampleRate),f=c.getChannelData(0);for(var d=0;d<b.buffer.length;d++){f[d]=b.buffer[d]}g.asset=a.createBufferSource();g.asset.buffer=c;g.asset.loop=true;var j=a.sampleRate/h,e=j/b.buffer.length;g.asset.playbackRate.value=1/e}},on:function(){var c=this;c.envelope=a.createGain(),gain=c.envelope.gain,values=b.envelopeValues,types=b.envelopeTypes,attack=values.attack,decay=values.decay,sustain=values.sustain,now=a.currentTime;gain.setValueAtTime(0.0001,now);if(types.attack==="linear"){gain.linearRampToValueAtTime(1,now+attack)}else{gain.exponentialRampToValueAtTime(1,now+attack)}if(types.decay==="linear"){gain.linearRampToValueAtTime(sustain,now+decay)}else{gain.exponentialRampToValueAtTime(sustain+0.0001,now+decay)}c.asset.connect(c.envelope);c.envelope.connect(b.input);c.asset.start(now)},off:function(){var g=this,m=b.envelopeValues,j=b.envelopeTypes,n=g.envelope.gain,k=n.value,f=m.attack,h=m.decay,o=m.sustain,l=m.release,c=a.currentTime,e;n.cancelScheduledValues(c);n.linearRampToValueAtTime(k,c);if(0<o){e=l-h}else{e=h-f}var d=c+e;if(j.release==="linear"){n.linearRampToValueAtTime(0,d)}else{n.exponentialRampToValueAtTime(0.0001,d)}g.asset.stop(d+0.2)}}},init:function(){var a=this;a.setVariables();a.setNotePrototype();a.handleKeys()}};app.tabs={setVariables:function(b,a){var c=this;c.width=b/6;c.tabHeight=50;c.top=(a-app.partsHeight)/2-c.tabHeight;c.tabNames=["wave","filters","envelope"];c.tabs={};c.container=dom.create("div",body);c.container.set().position("absolute").left((b-c.width)/2).top(c.top);c.currentTab=undefined},switchTab:function(a){var b=this;b.currentTab.draw("inactive");b.currentTab=a;a.draw("active");app.plane.switchTab(a.name);app.sideBar.switchTab(a.name)},makeTabs:function(){var e=this,f=e.tabNames.length,g=e.width/(f+1);for(var b=0;b<e.tabNames.length;b++){var d=e.tabNames[b],c=app.storage.instrumentTabs[d],a=g*(b+1);e.tabs[d]=new e.Tab(d,c,a)}},Tab:function(c,h,k){var b=this,j=app.tabs,d=j.tabHeight;b.name=c;b.canvas=dom.create("canvas",j.container);b.canvas.set().position("absolute").canWidth(d).canHeight(d).left(k-d/2).borderRadius(4);b.canvas.onclick=function(){if(b!==j.currentTab){j.switchTab(b)}};b.canvas.onmouseenter=function(){if(b!==j.currentTab){b.draw("hover")}b.popup.set().display("table");preservePointer()};b.canvas.onmouseleave=function(){if(b!==j.currentTab){b.draw("inactive")}b.popup.set().display("none");defaultCursor()};b.icon=h;var e={color:colors.gray8,font:fonts.text+"-UltraLight",size:16};b.popup=dom.create("div",j.container);b.popup.set().position("absolute").top(62).padding(10,["Left","Right"]).height(30).background(colors.gray3).borderRadius(6).display("table").paragraph(b.name,e);var g=b.popup.getBoundingClientRect(),f=g.width/2;b.popup.set().left(k-f).display("none");b.popup.cusp=dom.create("div",b.popup);var a=8;b.popup.cusp.set().position("absolute").left(f-a).top(-a).border(a,"transparent",["Left","Right"]).borderBottom(a,colors.gray3);return b},setTabPrototype:function(){var a=this;this.Tab.prototype={draw:function(e){var d=this,c=d.canvas.context,b=app.storage.colors;if(e==="hover"){d.canvas.set().background(b.gray6)}else{if(e==="active"){d.canvas.set().background(b[this.name])}else{d.canvas.set().background(b.gray7)}}d.icon(c,d.canvas.width,e)}}},setState:function(){var e=this,d=app.initialTabName;for(var b=0;b<e.tabNames.length;b++){var a=e.tabNames[b],c=e.tabs[a];if(d===c.name){e.currentTab=c;e.switchTab(c)}else{c.draw("inactive")}}},init:function(b,a){var c=this;c.setVariables(b,a);c.setTabPrototype();c.makeTabs();c.setState()}};app.help={setVariables:function(b,a){var d=this;d.showingPopup=false;d.popupWidth=b*1/2;d.popupHeight=a*1/2;d.popupTop=(a-d.popupHeight)/2;d.popupLeft=(b-d.popupWidth)/2;d.iconHeight=36;d.iconTop=12;d.iconLeft=12;var c={font:fonts.text+"-Light",size:18,color:colors.gray5,width:d.iconHeight,height:d.iconHeight,background:colors.gray1,hover:colors.gray2,borderRadius:d.iconHeight/2},e=function(){d.togglePopup()};d.icon=dom.makeButton(body,"?",c,e);d.icon.set().position("absolute").left(d.iconLeft).top(d.iconTop)},makePopup:function(){var b=this;b.popup=dom.create("div",body);b.popup.set().transition("0.4s").width(b.popupWidth).height(b.popupHeight).position("absolute").left(b.popupLeft).top(b.popupTop).boxShadow(0,0,6,0,colors.gray4).borderRadius(4).display("none").background(colors.gray7);var c=dom.create("p",b.popup),a="<b>1.</b> In the wave tab, choose a wave type to act as your sound wave. If you choose custom type (the bottom one) draw your pattern on the display to the left. Click 'Round It!' to initiate your drawing.<br><b>2.</b> Use the filters tab to impose different filter types on your sound wave. The gray line shows a sum of all the filters that are active.<br><b>3.</b> Customize the envelope of your sound in the envelope tab.<br><b>4.</b> Finally, play the keys on your computer keyboard to hear the sound in action!<br><br><b>Contact: josephljohnston@mac.com</b>";c.set().width(b.popupWidth*(2/3)).height(b.popupHeight*(2/3)).font(fonts.text).size(16).color(colors.gray1).overflow("auto").innerHTML(a).position("absolute").left(b.popupWidth*(1/6)).top(b.popupHeight*(1/6));c.style.lineHeight="140%";c.style["word-wrap"]="break-word"},togglePopup:function(){var a=this;if(a.showingPopup){a.popup.set().display("none");a.showingPopup=false}else{a.popup.set().display("block");a.showingPopup=true}},init:function(b,a){var c=this;c.setVariables(b,a);c.makePopup()}};app.plane={setVariables:function(b,a){var c=this;c.width=app.planeWidth;c.height=app.partsHeight;c.left=(b-c.width-app.middleSpacing-app.sideBarWidth)/2;c.canvas=dom.create("canvas",body);c.canvas.set().position("absolute").canWidth(c.width).canHeight(c.height).left(c.left).borderRadius(4).top(app.partTops).boxShadow(0,0,8,0,colors.gray7).background("white");c.currentTab=undefined},switchTab:function(c){var b=this,a=b.canvas;a.context.clearRect(0,0,a.width,a.height);if(b.currentTab){b.currentTab.toggleMode()}b.currentTab=b[c];b.currentTab.toggleMode()},mousedown:function(){var a=this;a.canvas.onmousedown=function(c){var b=a.getMouse(c);a.currentTab.mousedown(b)}},mousemove:function(){var a=this;a.canvas.onmousemove=function(c){var b=a.getMouse(c);a.currentTab.mousemove(b)}},mouseup:function(){var a=this;window.addEventListener("mouseup",function(c){var b=a.getMouse(c);a.currentTab.mouseup(b)})},getMouse:function(c){var b=this,a=b.canvas.getBoundingClientRect();return{x:c.clientX-a.left,y:c.clientY-a.top}},init:function(b,a){var c=this;c.setVariables(b,a);c.mousedown();c.mousemove();c.mouseup();c.wave.init();c.filters.init();c.envelope.init()}};app.plane.envelope={setVariables:function(){var a=this;a.canvas=app.plane.canvas;a.width=app.plane.width;a.height=app.plane.height;a.propertyNames=app.player.envelopeProperties;a.properties={}},toggleMode:function(){var a=this;a.draw()},convertVert:function(b){var a=this;return b*a.height/2},convertHoriz:function(b){var a=this;return b/4*a.width},changeProperty:function(e,b,d){var c=this,a=c.properties[e];if(e==="sustain"){a.value=c.convertVert(d)}else{a.value=c.convertHoriz(d)}if(e!=="sustain"){a.type=b}c.draw()},calculateExponential:function(d,f,c,e){var g=this,b=[];for(var a=d;a<=c;a++){b.push(f*Math.pow((e/f),(a-d)/(c-d)))}return b},draw:function(){var c=this,k=c.canvas.context;k.clearRect(0,0,c.canvas.width,c.canvas.height);k.fillStyle=colors.envelope;var b=c.properties.attack,d=c.properties.decay,j=c.properties.sustain,h=c.properties.release;k.beginPath();k.moveTo(h.value,c.height/2);if(h.type==="linear"){k.lineTo(d.value,200-j.value)}else{var f=d.value,a=c.calculateExponential(f,j.value,h.value+1,0.0001);for(var g=a.length-1;g>-1;g--){k.lineTo(f+g,-a[g]+200)}}if(d.type==="linear"){k.lineTo(b.value,0)}else{var f=b.value,a=c.calculateExponential(f,200,d.value,j.value);for(var g=a.length-1;g>-1;g--){k.lineTo(f+g,-a[g]+200)}}if(b.type==="linear"){k.lineTo(0,c.height/2)}else{var a=c.calculateExponential(0,0.0001,b.value,200);for(var g=a.length-1;g>-1;g--){k.lineTo(g,-a[g]+200)}}k.closePath();k.fill();if(h.type==="linear"){k.lineTo(d.value,c.height-(200-j.value))}else{var f=d.value,a=c.calculateExponential(f,j.value,h.value+1,0.0001);for(var g=a.length-1;g>-1;g--){k.lineTo(f+g,a[g]+200)}}if(d.type==="linear"){k.lineTo(b.value,c.height)}else{var f=b.value,a=c.calculateExponential(f,200,d.value,j.value);for(var g=a.length-1;g>-1;g--){k.lineTo(f+g,a[g]+200)}}if(b.type==="linear"){k.lineTo(0,c.height/2)}else{var a=c.calculateExponential(0,0.0001,b.value,200);for(var g=a.length-1;g>-1;g--){k.lineTo(g,a[g]+200)}}k.closePath();k.fill()},mousedown:function(a){},mousemove:function(a){},mouseup:function(a){},setState:function(){var f=this,a=app.player.envelopeValues;for(var c=0;c<f.propertyNames.length;c++){var e=f.propertyNames[c];f.properties[e]={};var b=f.properties[e];b.type="linear";var d=a[e];if(e==="sustain"){b.value=f.convertVert(d)}else{b.value=f.convertHoriz(d)}}},init:function(){var a=this;a.setVariables();a.setState()}};app.plane.filters={setVariables:function(){var b=this,a=app.plane;b.canvas=a.canvas;b.width=a.width;b.height=a.height;b.drawing=undefined;b.nyquist=app.nyquist;b.dbScale=60;b.binResolution=app.player.binResolution;b.numOctaves=app.numOctaves;b.pixelsPerDb=(b.height/2)/b.dbScale;b.animFrame=undefined},dbToY:function(a){var b=this;return(b.height/2)-b.pixelsPerDb*a},toggleMode:function(){var a=this;a.toggleDrawing()},toggleDrawing:function(){var b=this;if(!b.drawing){b.animFrame=window.requestAnimationFrame(a);b.drawing=true}else{window.cancelAnimationFrame(b.animFrame);b.drawing=false}function a(){b.draw();b.animFrame=window.requestAnimationFrame(a)}},draw:function(){var d=this,a=d.canvas.context,b=app.player,c=b.sendFilterResponses(),e=b.sendFrequencies();a.clearRect(0,0,d.canvas.width,d.canvas.height);d.drawFilters(c);d.drawComposite(c);d.drawFrequencies(e)},drawFilters:function(k){var g=this,d=g.canvas,m=d.context,b=d.width,c=k.length;for(var h=0;h<c;h++){var e=k[h],f=e.data,j=e.hue;m.beginPath();m.moveTo(-10,-10);for(var a=0,l;a<f.length;a++){l=g.dbToY(f[a]);m.lineTo(a,l)}m.lineTo(b+10,l);m.lineTo(b+10,-10);m.closePath();if(e.active){m.fillStyle="hsla("+j+",100%,78%,0.7)"}else{m.fillStyle="hsla("+j+",100%,86%,0.2)"}m.fill()}},drawComposite:function(g){var e=this,d=e.canvas,j=d.context,b=d.width;if(g.length>0){var c=g[0].data.length}j.beginPath();for(var f=0,h;f<c;f++){h=0;for(var a=0;a<g.length;a++){h+=g[a].data[f]}j.lineTo(f,e.dbToY(h))}j.lineWidth=4;j.strokeStyle=colors.gray6;j.stroke()},drawAxes:function(){var f=this,b=f.canvas.context;var g=f.width/f.numOctaves;for(var d=0;d<=f.numOctaves;d++){var a=d*g;b.beginPath();b.moveTo(a,0);b.lineTo(a,f.height);b.stroke();var c=f.nyquist*Math.pow(2,d-f.numOctaves),e=" Hz";if(c>=1000){c=c/1000;e=" kHz"}b.strokeText(c.toFixed(2)+e,a+5,20)}for(var d=-f.dbScale;d<f.dbScale;d+=10){var h=f.dbToY(d);b.beginPath();b.moveTo(0,h);b.lineTo(f.width,h);b.stroke();b.strokeText(d+" db",f.width-40,h-5)}},drawFrequencies:function(b){var e=this,a=b.length,n=e.canvas.context;n.fillStyle=colors.gray6;for(var f=0,g;f<a;f++){var c=f/a,j=e.nyquist*Math.pow(2,e.numOctaves*(c-1)),k=Math.floor(j/e.binResolution);var l=b[k],h=l/256,m=e.height*h,d=e.height-m,o=e.width/a;n.fillRect(f*o,d,o,m);g=k}},mousedown:function(a){var b=this},mousemove:function(a){var b=this},mouseup:function(a){var b=this},setState:function(){var a=this;a.drawing=false},init:function(){var a=this;a.setVariables()}};app.plane.wave={setVariables:function(){var d=this,a=app.plane;d.width=a.width;d.height=a.height;d.points=[];for(var b=0,c=d.height/2;b<d.width;b++){d.points.push(c)}d.dragging=false;d.lastX;d.wave=undefined;d.coefs={real:undefined,imag:undefined};d.totalCoefs=undefined;d.lastDrawnPoints=d.points.slice(0)},toggleMode:function(){var a=this;a.redraw()},sendCoefs:function(){var a=this;return a.coefs},sendStatic:function(){var b=this,a=b.points.slice(0);b.convertAmp(a);return a},showOriginal:function(){var a=this;a.newWave(a.lastDrawnPoints)},newWave:function(a){var b=this;b.points=a.slice(0);b.redraw()},drawDefault:function(d){var e=this,c=[];if(d==="sine"){for(var b=0;b<e.width;b++){c[b]=Math.sin((b*2*Math.PI)/e.width)}}else{if(d==="square"){for(var b=0;b<e.width;b++){if(b===0){c[b]=0}else{if(b===e.width-1){c[b]=0}else{if(b<e.width/2){c[b]=0.995}else{c[b]=-0.995}}}}}else{if(d==="sawtooth"){var a=2/e.width;for(var b=0;b<e.width;b++){if(b<e.width/2){c[b]=b*a}else{c[b]=b*a-2}}}else{if(d==="triangle"){var a=2/(e.width/2);for(var b=0;b<e.width;b++){if(b<e.width/4){c[b]=b*a}else{if(b<e.width*3/4){c[b]=-(b*a)+2}else{c[b]=b*a-4}}}}}}}e.reverseAmp(c);e.lastDrawnPoints=c.slice(0);e.newWave(c)},mousedown:function(b){var c=this,a=b.x;if(app.sideBar.wave.waveType!=="custom"){return}c.showingWave=false;c.dragging=true;c.lastX=a;c.points[a]=b.y;c.redraw()},mouseup:function(a){var b=this;if(b.dragging){b.lastDrawnPoints=b.points.slice(0)}b.dragging=false;b.lastX=undefined},mousemove:function(e){var d=this;if(!d.dragging){return}var l=d.points,j=Math.floor(e.x),f=Math.floor(e.y),a=d.lastX;if(a+1<j){var h=j-a,g=l[a]-f;for(var c=0;c<h+1;c++){var b=c/h,k=Math.round(l[a]-b*g);d.points[a+c]=k}}else{if(j<a-1){var h=a-j,g=l[a]-f;for(var c=h;c>-1;c--){var b=c/h,k=Math.round(l[a]-b*g);d.points[a-c]=k}}else{d.points[j]=f}}d.lastX=j;d.redraw()},redraw:function(){var c=this,a=app.plane.canvas.context;a.clearRect(0,0,c.width,c.height);a.beginPath();a.moveTo(0,c.points[0]);for(var b=0;b<c.width;b++){a.lineTo(b,c.points[Math.round((b/c.width)*c.points.length)])}a.strokeStyle=colors.wave;a.lineWidth=2;a.stroke()},crunch:function(a){var d=this,a=a,g=[],h=[];d.wave=d.lastDrawnPoints.slice(0);d.convertAmp(d.wave);for(var e=0;e<a;++e){var c=d.calcCosSub(e),f=d.calcIntegral(c),j=d.calcCoef(f);if(e%a===0){j/=2}g.push(j);if(e===0){var l=0}else{var b=d.calcSinSub(e),k=d.calcIntegral(b);l=d.calcCoef(k)}h.push(l)}d.coefs.real=new Float32Array(g);d.coefs.imag=new Float32Array(h);d.reverse(a)},calcCosSub:function(e){var c=this,a=[];function d(f){return Math.cos((2*Math.PI)*(e*f))}for(var b=0;b<c.wave.length;b++){a.push(c.wave[b]*d(b/c.wave.length))}return a},calcSinSub:function(d){var b=this,e=[];function c(f){return Math.sin((2*Math.PI)*(d*f))}for(var a=0;a<b.wave.length;a++){e.push(b.wave[a]*c(a/b.wave.length))}return e},calcIntegral:function(b){var f=this,e=b.length,d=1/e,c=0;for(var a=0;a<b.length;a++){c+=b[a]*d}return c},calcCoef:function(b){var a=this;return 2*b},reverse:function(e){var f=this,d=[];for(var c=0;c<f.wave.length;++c){d.push(0)}for(var c=0;c<e;++c){var a=f.reverseCosSub(f.coefs.real[c],c),g=f.reverseSinSub(f.coefs.imag[c],c);for(var b=0;b<d.length;b++){d[b]+=a[b]+g[b]}}f.reverseAmp(d);f.newWave(d)},reverseCosSub:function(f,g){var e=this,d=[];for(var c=0;c<e.wave.length;++c){var b=c/e.wave.length,a=f*Math.cos((2*Math.PI)*(g*b));d.push(a)}return d},reverseSinSub:function(f,g){var e=this,b=[];for(var d=0;d<e.wave.length;++d){var c=d/e.wave.length,a=f*Math.sin((2*Math.PI)*(g*c));b.push(a)}return b},reverseAmp:function(e){var f=this,b=f.height,d=b/2,g=b/2;for(var c=0;c<e.length;++c){var a=e[c];a=a*d;a=a+g;a=b-a;e[c]=a}},convertAmp:function(e){var f=this,b=f.height,g=b/2,d=b/2;for(var c=0;c<e.length;++c){var a=e[c];a=b-a;a=a-g;a=a/d;e[c]=a}},setState:function(){var a=this;a.points=[200,200,200,200,200,200,200,227,224,220,217,214,211,207,204,201,199,196,193,190,188,185,182,179,177,174,171,168,166,163,160,157,155,152,149,146,144,141,138,135,133,130,127,124,122,119,118,118,117,116,118,119,299,298,297,295,294,293,292,291,289,288,287,286,284,283,281,280,279,278,277,276,275,274,273,272,271,270,269,268,267,266,265,264,263,262,261,260,259,258,257,256,255,254,253,252,251,250,249,248,246,245,244,243,241,240,239,238,237,235,234,233,232,230,229,228,227,226,224,223,222,221,220,218,217,216,216,216,276,274,273,273,272,270,268,266,264,263,261,259,257,254,252,249,247,244,241,237,234,231,228,226,223,220,217,214,211,207,204,201,200,198,197,196,194,193,193,192,192,192,192,192,192,192,193,193,194,195,197,199,202,204,208,211,214,217,220,223,226,231,236,241,244,248,251,254,257,261,264,266,268,270,272,275,277,279,281,283,285,287,288,290,292,294,295,297,299,300,301,302,303,304,305,306,307,308,308,308,309,309,309,309,309,309,310,310,310,310,310,310,310,310,310,309,309,309,309,308,308,308,308,308,308,307,305,304,303,302,301,300,299,298,297,296,295,294,292,291,290,288,287,286,285,283,282,281,280,278,277,276,275,273,272,271,270,268,267,266,265,264,263,262,260,259,258,257,256,255,254,253,252,250,249,248,247,246,245,244,243,241,240,239,238,237,236,235,235,234,233,232,232,231,230,229,229,228,227,226,226,225,224,223,223,222,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,224,227,265,264,263,261,259,257,254,252,250,248,246,244,243,241,239,237,234,231,229,226,223,220,218,215,212,209,206,203,200,196,193,190,187,182,178,173,169,164,161,157,154,150,147,144,141,139,136,133,129,125,124,123,122,121,122,122,123,123,124,124,125,125,126,127,128,129,129,130,131,132,133,134,136,137,138,139,141,142,143,145,146,148,149,151,152,154,156,157,159,160,162,163,165,166,168,170,172,174,176,178,180,181,183,185,187,189,191,193,196,199,202,205,208,211,214,217,220,223,226,229,236,244,251,268,267,266,264,263,262,260,259,257,256,254,253,251,250,249,247,246,245,243,242,240,239,238,236,235,234,232,231,229,228,226,225,223,222,220,219,217,216,214,213,211,210,208,207,205,204,202,201,199,198,196,195,194,192,191,190,189,187,186,185,183,182,181,179,178,177,175,174,173,172,170,169,168,166,165,164,163,162,161,213,212,211,210,209,208,207,206,205,205,205,205,265,265,265,264,264,264,264,264,263,263,263,262,262,262,262,261,261,261,260,260,260,259,259,259,259,258,258,258,258,257,257,257,257,256,256,256,255,255,255,255,254,254,254,253,253,253,253,252,252,252,251,251,251,251,250,250,250,250,250,250,250,249,249,249,249,249,249,248,247,247,254,253,252,250,249,248,247,246,245,244,243,242,242,241,240,239,238,237,236,235,235,234,233,232,232,231,230,230,229,228,227,227,226,225,225,224,223,223,222,221,220,220,219,219,219,219,219,219,218,218,218,218,218,218,218,218,218,220,222,229,288,287,287,286,285,284,283,282,282,281,280,280,279,279,278,277,277,276,275,274,274,273,272,271,270,269,269,268,267,266,265,265,264,263,262,262,261,260,259,259,258,257,256,256,255,254,253,253,252,251,250,250,249,248,247,247,246,245,244,244,243,242,241,240,239,238,238,237,236,235,234,233,232,231,231,230,229,228,228,227,226,225,225,224,223,222,222,221,220,219,218,217,216,215,214,213,212,210,209,208,208.5,200,200,200,200];a.lastDrawnPoints=a.points.slice(0)},init:function(){var a=this;a.setVariables();a.setState()}};app.sideBar={setVariables:function(b,a){var c=this;c.width=app.sideBarWidth;c.height=app.partsHeight;c.left=b-(b-app.planeWidth-app.middleSpacing-c.width)/2-c.width;c.container=dom.create("div",body);c.container.set().position("absolute").width(c.width).height(c.height).left(c.left).top(app.partTops).boxShadow(0,0,8,0,colors.gray7).borderRadius(3);c.currentTab=undefined},switchTab:function(b){var a=this;if(a.currentTab){a.currentTab.container.set().display("none");a.currentTab.toggleMode()}a.container.set().background(colors[b]);a.currentTab=a[b];a.currentTab.container.set().display("block");a.currentTab.toggleMode()},init:function(b,a){var c=this;c.setVariables(b,a);c.wave.init();c.filters.init();c.envelope.init()}};app.sideBar.envelope={setVariables:function(){var b=this,a=app.sideBar;b.width=a.width;b.height=a.height;b.container=dom.create("div",a.container);b.container.set().position("absolute").width(b.width).height(b.height).display("none");b.rangerProperties=app.player.envelopeProperties;b.rangerValues=app.player.envelopeValues;b.rangers={}},changePropertyValue:function(a,d){var c=this,b=a.property;if(b==="attack"){if(!(d<c.rangerValues.decay)){d=c.rangerValues.decay-0.001}}else{if(b==="decay"){if(!(d>c.rangerValues.attack)){d=c.rangerValues.attack+0.001}else{if(!(d<c.rangerValues.release)){d=c.rangerValues.release-0.001}}}else{if(b==="sustain"){}else{if(b==="release"){if(!(d>c.rangerValues.decay)){d=c.rangerValues.decay+0.001}}}}}c.rangerValues[b]=d;c.sendChanges(a)},changePropertyType:function(a,b){var c=this;a.type=b;c.renderRangerTitle(a);c.sendChanges(a)},sendChanges:function(a){var e=this,d=a.property,b=a.type?a.type:undefined,c=e.rangerValues[d];app.plane.envelope.changeProperty(d,b,c);app.player.changeEnvelope(d,b,c);e.renderRangerTitle(a)},renderRangerTitle:function(a){var e=this,b=a.type?a.type:"",d=a.property,c=e.rangerValues[d];a.title.p.set().innerHTML(b+" "+d+" "+c.toFixed(1))},makeRangers:function(){var h=this,q={width:200,height:sizes.sliderHeight},e=40,u=app.player,x=u.envelopeValues;for(var v=0;v<h.rangerProperties.length;v++){var k=h.rangerProperties[v],f={},p=5+v*100,l=40;f.property=k;f.value=x[k];f.range=(k==="sustain")?[0,1,f.value]:[0,u.envelopeDuration,f.value];f.title=dom.create("div",h.container);f.title.set().position("absolute").top(p).width(h.width).height(l).display("table").background(colors.divActive);f.title.p=dom.create("p",f.title);f.title.p.set().color(colors.textActive).textAlign("center").display("table-cell").verticalAlign("middle").font(fonts.sideBar).size(24);var n=q.width+e,b=h.width-n,g=b/3,s=10,d=(k!=="sustain")?g:g;(function(y){y.onchange=function(z){h.changePropertyValue(y,z)}})(f);f.slider=dom.makeSlider(h.container,q,f.range,f.onchange);f.slider.set().position("absolute").left(Math.round(d)).top(p+l+s/2+e/2);var w={width:e,height:e,borderRadius:4,background:colors.itemRegular};if(k!=="sustain"){f.type="linear";var r=app.storage.envelopeTypes,m={width:e,height:e},j;(function(y){j=function(z){h.changePropertyType(y,z.name)}})(f);f.selector=dom.makeSelector(h.container,h.width-g-e,p+l+s,r,w,r,m,j,true);var a=f.selector.button,t=a.canvas.context,c=e;if(u.envelopeTypes[k]==="linear"){a.currentItem=r[0]}else{a.currentItem=r[1];h.changePropertyType(f,"exponential")}a.currentItem.icon.draw(t,c)}else{var o=dom.create("div",h.container);o.set().width(w.width).height(w.height).background(w.background).position("absolute").top(p+l+s).left(h.width-g-e).borderRadius(w.borderRadius)}h.renderRangerTitle(f);h.rangers[v]=f;f=undefined}},toggleMode:function(){var a=this},init:function(){var a=this;a.setVariables();a.makeRangers()}};app.sideBar.filters={setVariables:function(){var d=this,a=app.sideBar,c=app.player,b=app.tabs;d.width=a.width;d.height=a.height;d.container=dom.create("div",a.container);d.container.set().position("absolute").width(d.width).height(d.height).display("none");d.blockWidth=40;d.blockNames=c.filterNames;d.filterProperties=c.filterProperties;d.filterRanges=c.filterRanges;d.nyquist=app.nyquist;d.numOctaves=app.numOctaves;d.blocks={};d.currentBlock=undefined;d.rangers=[]},toggleMode:function(){var a=this},changePropertyValue:function(a,d){var c=this,b=a.property,e=app.filterValueToReal(b,d);c.currentBlock.properties[b]=d;a.title.p.set().innerHTML(b+" "+e.toFixed(2));app.player.changeFilterValue(c.currentBlock.id,b,e)},switchBlock:function(c){var b=this,a=b.button;b.currentBlock.draw("inactive");b.currentBlock=c;c.draw("active");if(c.active){b.showRangers();if(!a.on){b.toggleButton()}}else{b.hideRangers();if(a.on){b.toggleButton()}}},hideRangers:function(){var b=this;for(var a=0;a<b.rangers.length;a++){b.rangers[a].makeInactive()}},showRangers:function(){var e=this,f=e.currentBlock;for(var c=0;c<e.rangers.length;c++){var b=e.rangers[c],d=b.property,a=(f.properties[d]!==undefined);if(a){b.makeActive();b.setValue(f.properties[d])}else{b.makeInactive()}}},toggleBlock:function(){var a=this,b=a.currentBlock;if(b.active){b.active=false;b.draw("active");a.hideRangers();a.toggleButton()}else{b.active=true;b.draw("active");a.showRangers();a.toggleButton()}app.player.toggleFilterMode(b.id)},toggleButton:function(){var b=this,a=b.button;if(a.on){a.text().innerHTML("on");a.on=false}else{a.text().innerHTML("off");a.on=true}},makeBlocks:function(){var e=this,n=e.blockNames.length,g=e.blockWidth,a=e.width-n*g,m=a/(n+1);for(var f=0;f<e.blockNames.length;f++){var l=e.blockNames[f],b=f,k=app.storage.filterIcons[l],c=m+f*(g+m),j=e.filterProperties[l],h=app.player.filterModes[f],d=new e.Block(l,b,k,c,j,h);e.blocks[b+""]=d}},Block:function(n,b,m,e,k,j){var h=this,c=app.sideBar.filters,d=c.filterRanges;h.name=n;h.id=b;h.active=j;var l=c.blockNames;h.hue=(b/l.length)*360;h.properties={};for(var g=0;g<k.length;++g){var o=k[g];for(var a=0;a<d.length;++a){var f=d[a];if(f.property===o){h.properties[o]=0}}}h.icon=m;h.canvas=dom.create("canvas",c.container);h.canvas.set().position("absolute").canWidth(c.blockWidth).canHeight(c.blockWidth).left(e).top(10).background(colors.gray3).borderRadius(4);h.canvas.onmousedown=function(){h.canvas.set().background(colors.itemActive);if(h!==c.currentBlock){c.switchBlock(h)}};h.canvas.onmouseup=function(){h.canvas.set().background(colors.itemHover)};h.canvas.onmouseenter=function(){h.canvas.set().background(colors.gray2);preservePointer()};h.canvas.onmouseleave=function(){h.canvas.set().background(colors.gray3);defaultCursor()}},setBlockPrototype:function(){var a=this;a.Block.prototype={draw:function(d){var c=this,b=c.canvas.context;b.lineWidth=2;if(c.active){if(d==="active"){b.strokeStyle="hsl("+c.hue+",100%,50%)"}else{b.strokeStyle="hsl("+c.hue+",40%,50%)"}}else{if(d==="active"){b.strokeStyle=colors.gray6}else{b.strokeStyle=colors.gray4}}c.icon(b,c.canvas.width)}}},makeButton:function(){var b=this,a={font:fonts.button,size:18,width:60,height:30,borderRadius:4,background:colors.buttonRegular,hover:colors.buttonHover,active:colors.buttonActive};b.button=dom.makeButton(b.container,"",a,function(){b.toggleBlock()});b.button.set().position("absolute").left((b.width-a.width)/2).top(75);b.button.on=undefined},makeRangers:function(){var e=this,b={width:200,height:sizes.sliderHeight,railColor:"red",blockColor:"blue"};for(var c=0;c<e.filterRanges.length;c++){var d=e.filterRanges[c],a={},f=130+c*90,g=40;a.active=false;a.property=d.property;a.range=d.range;a.title=dom.create("div",e.container);a.title.set().position("absolute").top(f).width(e.width).height(g).display("table");a.title.p=dom.create("p",a.title);a.title.p.set().textAlign("center").display("table-cell").verticalAlign("middle").font(fonts.sideBar).size(24);(function(h){h.onchange=function(j){e.changePropertyValue(h,j)}})(a);a.slider=dom.makeSlider(e.container,b,a.range,a.onchange);a.slider.set().position("absolute").left((e.width-b.width)/2).top(f+g+20);(function(h){h.setValue=function(j){h.slider.setValue(j)}})(a);(function(h){h.makeInactive=function(){h.slider.makeInactive();h.title.set().background(colors.divInactive);h.title.p.set().color(colors.textInactive)}})(a);(function(h){h.makeActive=function(){h.slider.makeActive();h.title.set().background(colors.divActive);h.title.p.set().color(colors.textActive)}})(a);e.rangers[c]=a;a=undefined}},setState:function(){var l=this,c=app.player.initialFilterValues,k=app.player.filterNames[3];l.button.on=true;l.button.text().innerHTML("off");for(var m=0;m<l.blockNames.length;++m){var b=l.blockNames[m],g=l.blocks[m+""],o=l.filterProperties[b];var d=c["_"+m];if(d){g.active=true;app.player.filters[m].mode=true}g.draw("inactive");for(var h=0;h<o.length;++h){var q=o[h];for(var a=0;a<l.filterRanges.length;++a){var f=l.filterRanges[a];if(f.property===q){if(d!==undefined){var e=d[a],n=app.filterValueToReal(q,e);g.properties[q]=e;app.player.changeFilterValue(m,q,n);app.player.filters[m].mode=true}else{var p=c._default[a],n=app.filterValueToReal(q,p);g.properties[q]=p;app.player.changeFilterValue(m,q,n)}}}}if(k===g.name){l.currentBlock=g;l.switchBlock(l.currentBlock)}}app.player.assembleFilters()},init:function(){var a=this;a.setVariables();a.setBlockPrototype();a.makeBlocks();a.makeRangers();a.makeButton();a.setState()}};app.sideBar.wave={setVariables:function(){var a=this;a.width=app.sideBar.width;a.height=app.sideBar.height;a.container=dom.create("div",app.sideBar.container);a.container.set().position("absolute").width(a.width).height(a.height).display("none");a.waveType=undefined},toggleMode:function(){var a=this},switchWave:function(b){var a=this;a.waveTitle.p.set().innerHTML(b+" wave");if(b!=="custom"){a.makeCurveInactive();app.plane.wave.drawDefault(b);app.player.changeWave("default",b)}else{a.makeCurveActive()}a.waveType=b},changeCurve:function(b){var a=this,b=Math.round(b);a.curveTitle.p.set().innerHTML("curvature "+b+"%")},makeCurveInactive:function(){var a=this;a.curveTitle.set().background(colors.divInactive);a.curveTitle.p.set().color(colors.textInactive).innerHTML("curvature 0%");a.slider.makeInactive();a.button.set().display("none")},makeCurveActive:function(){var b=this,a=Math.round(b.slider.getValue());b.curveTitle.set().background(colors.divActive);b.curveTitle.p.set().color(colors.textActive).innerHTML("curvature "+a+"%");b.slider.makeActive();b.slider.setValue(a);b.button.set().display("table")},createWave:function(){var d=this,c=Math.round(d.slider.getValue()),e=52-Math.round(c/2),a=app.plane.wave,b=app.player;if(e===52){a.showOriginal();b.changeWave("static",a.sendStatic())}else{a.crunch(e);b.changeWave("curved",a.sendCoefs())}},makeWaveTitle:function(){var a=this;a.waveTitle=dom.create("div",a.container);a.waveTitle.set().position("absolute").top(20).width(a.width).height(40).display("table").background(colors.divActive);a.waveTitle.p=dom.create("p",a.waveTitle);a.waveTitle.p.set().color(colors.textActive).textAlign("center").display("table-cell").verticalAlign("middle").font(fonts.sideBar).size(32)},makeSelector:function(){var c=this,b=app.storage.waveIcons,g=60,a={width:g,height:g,borderRadius:4,background:colors.itemRegular},f={width:g,height:g},e=(c.width-g)/2,d=80,h=function(j){c.switchWave(j.name)};c.waveSelector=dom.makeSelector(c.container,e,d,b,a,b,f,h,true)},makeCurveTitle:function(){var a=this;a.curveTitle=dom.create("div",a.container);a.curveTitle.set().position("absolute").top(180).width(a.width).height(40).display("table");a.curveTitle.p=dom.create("p",a.curveTitle);a.curveTitle.p.set().textAlign("center").display("table-cell").verticalAlign("middle").font(fonts.sideBar).size(32).innerHTML("curvature 0%")},makeSlider:function(){var d=this,b={width:d.width-100,height:sizes.sliderHeight},a=[0,100,34],c=function(e){d.changeCurve(e)};d.slider=dom.makeSlider(d.container,b,a,c);d.slider.set().position("absolute").left(50).top(250)},makeButton:function(){var b=this,a={width:120,height:50,font:fonts.button,size:24,background:colors.buttonRegular,hover:colors.buttonHover,active:colors.buttonActive,borderRadius:4},c=function(){b.createWave()};b.button=dom.makeButton(b.container,"Round It!",a,c);b.button.set().position("absolute").top(310).left((b.width-a.width)/2)},setState:function(){var g=this,f="custom",h;g.currentWave=f;g.waveTitle.p.set().innerHTML(f);var e=app.storage.waveIcons,d=g.waveSelector.button,a=d.canvas.context,c=d.points.side;for(var b=0;b<e.length;b++){if(e[b].name===f){h=e[b]}}h.icon.draw(a,c);d.currentItem=h;g.curvature=34;g.switchWave(f);g.changeCurve(34);g.createWave()},init:function(){var a=this;a.setVariables();a.makeWaveTitle();a.makeSelector();a.makeCurveTitle();a.makeSlider();a.makeButton();a.setState()}};